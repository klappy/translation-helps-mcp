# Search Indexer Worker Configuration
# This worker consumes R2 event notifications when ZIP files are cached
# and populates the search index bucket with cleaned, chunked content.

name = "translation-helps-indexer"
main = "index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Source bucket (read ZIPs)
[[r2_buckets]]
binding = "SOURCE_BUCKET"
bucket_name = "translation-helps-mcp-zip-persistence"

# Destination bucket (write clean chunks)
[[r2_buckets]]
binding = "SEARCH_INDEX_BUCKET"
bucket_name = "translation-helps-search-index"

# Queue consumer configuration
[[queues.consumers]]
queue = "zip-indexing-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "zip-indexing-dlq"

# Environment variables for AI Search reindex trigger
[vars]
# CF_ACCOUNT_ID is set via deploy command from GitHub secrets
AI_SEARCH_INDEX_ID = "translation-helps-search"

# CF_API_TOKEN stored as secret (npx wrangler secret put CF_API_TOKEN --config src/workers/indexer/wrangler.toml)

